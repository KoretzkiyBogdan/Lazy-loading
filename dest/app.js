!function(e){var t=function(e,t){this.apiUrl=e,this.apiKey=t};t.prototype._GET=function(e,t){t="function"==typeof t?t:function(){};var o=new XMLHttpRequest;o.addEventListener("load",function(){try{var e=JSON.parse(this.responseText);t(null,e)}catch(e){console.error(e),t(new Error("Non valid JSON"))}}),o.addEventListener("error",function(){t(new Error("Error: "+(this.status?this.statusText:"request failed")))}),o.open("GET",e,!0),o.send()},t.prototype.getPhotoLinks=function(e,t){t="function"==typeof t?t:function(){};var o={method:"flickr.photos.getRecent",api_key:this.apiKey,page:e?e.page:1,per_page:e?e.perPage:50,extras:"url_o,url_m",format:"json",nojsoncallback:1},i=Object.keys(o).map(function(e){return e+"="+o[e]}).join("&");return this._GET(this.apiUrl+"?"+i,function(e,o){if(!o||"ok"!==o.stat)return t(e);var i=(o&&o.photos?o.photos.photo:[]).map(function(e){return e.url_m||e.url_o});t(null,i)})};var o=function(e){e=e||{},this.rootElement=e.rootElement,this.imgHeight=e.imgHeight||180,this.container=document.createElement("div"),this.container.className="container",this.rootElement.appendChild(this.container),this.onWheel=function(){},this.onKeyDown=function(){},this.rootElement.addEventListener("wheel",this.onWheel)};o.prototype.selectElement=function(e){for(var t=document.querySelectorAll(".photo-container"),o=0;o<t.length;o++)o!==e&&t[o].classList.contains("active")&&t[o].classList.remove("active"),o===e&&t[o].classList.add("active")},o.prototype.scrollToRow=function(e,t,o){var i=e-1.5,n=this.imgHeight+44,s=parseInt(this.container.style.top.replace("px","")||0),h=e<2?0:-n*i,r=s;if(t)var l=(h-s)/6,a=0,c=setInterval(function(){if(a>=6)return"function"==typeof o&&o(),clearInterval(c);r+=l,this.container.style.top=r+"px",a++}.bind(this),30);else this.container.style.top=h+"px"},o.prototype.render=function(e,t){var o=this,i=document.createDocumentFragment();e.forEach(function(e){var t=document.createElement("div"),n=document.createElement("img");t.className="photo-container",t.style.height=o.imgHeight+"px",n.className="photo",n.src=e,t.appendChild(n),i.appendChild(t)}),t?this.container.appendChild(i):this.container.insertBefore(i,this.container.firstChild)},o.prototype.removeElements=function(e,t){for(var o=document.querySelectorAll(".photo-container"),i=o.length-1,n=t?0:i,s=t?1:-1;t?n<e:n>i-e;)o[n].remove(),n+=s};var i=function(e,t){this.view=e,this.model=t,this.photosInRow=5,this.photoPerPage=50,this.availableOffset=15,this.page=1,this.photoLinks=[],this.selectedElementIndex=0,this._onWheel=!1,this._onRequest=!1,this.initialize()};i.prototype.initialize=function(){this.model.getPhotoLinks({page:this.page,perPage:this.photoPerPage},function(e,t){if(e)return e;this.photoLinks=this.photoLinks.concat(t),this.view.render(this.photoLinks.slice(-this.photoPerPage),!0),this.view.selectElement(this.selectedElementIndex),this.view.scrollToRow(1)}.bind(this)),this.view.rootElement.addEventListener("wheel",this.onWheel.bind(this)),this.view.onWheel=this.onWheel.bind(this),document.addEventListener("keyup",this.onKeyUp.bind(this))},i.prototype.onWheel=function(e){if(this._onWheel)return!1;this._onWheel=!0,this.moveSelectElement(e.deltaY>0?this.photosInRow:-this.photosInRow,function(){this._onWheel=!1}.bind(this))},i.prototype.onKeyUp=function(e){switch(e.keyCode){case 37:this.moveSelectElement(-1);break;case 38:this.moveSelectElement(-this.photosInRow);break;case 39:this.moveSelectElement(1);break;case 40:this.moveSelectElement(this.photosInRow)}},i.prototype.getMorePhotos=function(){if(!this._onRequest){var e=this.page+1,t=this.page*this.photoPerPage,o=t+(this.photoPerPage-this.availableOffset);if(o<this.photoLinks.length)return this.selectedElementIndex=this.selectedElementIndex%this.photosInRow+this.photosInRow,this.view.removeElements(this.photoPerPage-this.availableOffset,!0),this.view.render(this.photoLinks.slice(t,o),!0),this.view.selectElement(this.selectedElementIndex),this.view.scrollToRow(2),void(this.page=e);this._onRequest=!0,this.model.getPhotoLinks({page:e,perPage:this.photoPerPage},function(i,n){if(this._onRequest=!1,i)return i;this.page=e,this.photoLinks=this.photoLinks.concat(n),this.selectedElementIndex=this.selectedElementIndex%this.photosInRow+this.photosInRow,this.view.removeElements(this.photoPerPage-this.availableOffset,!0),this.view.render(this.photoLinks.slice(t,o),!0),this.view.selectElement(this.selectedElementIndex),this.view.scrollToRow(2)}.bind(this))}},i.prototype.getCachedPhotos=function(){var e=this.page-1,t=(e-1)*this.photoPerPage,o=t+(this.photoPerPage-this.availableOffset);this.selectedElementIndex=this.selectedElementIndex%this.photosInRow+(this.photoPerPage-this.availableOffset),this.view.removeElements(this.photoPerPage-this.availableOffset,!1),this.view.render(this.photoLinks.slice(t,o),!1),this.view.selectElement(this.selectedElementIndex),this.view.scrollToRow(8),this.page=e},i.prototype.moveSelectElement=function(e,t){if(this._onRequest)return t();var o=this,i=this.selectedElementIndex+e,n=this.photoLinks.length,s=Math.floor(this.photoPerPage/this.photosInRow),h=Math.floor(i/this.photosInRow)+1,r=h-(Math.floor(this.selectedElementIndex/this.photosInRow)+1)==-1;if(i<0)return t();i<=n-1&&(this.selectedElementIndex=i,this.view.selectElement(this.selectedElementIndex),this.view.scrollToRow(h,!0,function(){h+1===s?o.getMorePhotos():r&&1===h&&1!==o.page&&o.getCachedPhotos(),"function"==typeof t&&t()}))},e.App=function(e){var n=new t((e=e||{}).apiUrl,e.secret),s=new o({rootElement:e.rootElement,imgHeight:e.imgHeight});return new i(s,n)}}(window);
//# sourceMappingURL=maps/app.js.map
